<!--{{ if and site.DisqusShortname (not (or site.Params.disable_comments .Params.disable_comments)) }}-->
<!--<section id="comments">-->
<!--  {{ template "_internal/disqus.html" . }}-->
<!--</section>-->
<!--{{ end }}-->
{{ if .Site.Params.enableGitalk }}
<div id="gitalk-container"></div>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script>
  //去除尾部匹配正则数组的字符串
  String.prototype.trimEnd = function(regStr)
  {
    var result = this;
    if(regStr==undefined||regStr==null||regStr=="")
    {
      return result;
    }
    var array = regStr.split(',');

    if(array.length > 0){

      var c = array.shift();
      var str= this;
      var i = str.length;
      var rg = new RegExp(c);
      var matchArr = str.match(rg);

      if(matchArr != undefined && matchArr != null && matchArr.length > 0)
      {
        var matchStr = matchArr[0].replace(/\\/g, "\\\\").replace(/\*/g, "\\*")
          .replace(/\+/g, "\\+").replace(/\|/g, "\\|")
          .replace(/\{/g, "\\{").replace(/\}/g, "\\}")
          .replace(/\(/g, "\\(").replace(/\)/g, "\\)")
          .replace(/\^/g, "\\^").replace(/\$/g, "\\$")
          .replace(/\[/g, "\\[").replace(/\]/g, "\\]")
          .replace(/\?/g, "\\?").replace(/\,/g, "\\,")
          .replace(/\./g, "\\.").replace(/\&/g, "\\&");
        matchStr = matchStr + '$';
        result = str.replace(new RegExp(matchStr), "");
      }

      if(array.length > 0){
        return result.trimEnd(array.join())
      }
      else{
        return result;
      }
    }
  };
</script>
<script>
  const gitalk = new Gitalk({
    clientID: '{{ .Site.Params.Gitalk.clientID }}',
    clientSecret: '{{ .Site.Params.Gitalk.clientSecret }}',
    repo: '{{ .Site.Params.Gitalk.repo }}',
    owner: '{{ .Site.Params.Gitalk.owner }}',
    admin: ["KimYangOfCat",] ,
    labels:['Comments'],
    id: md5(location.href.trimEnd('location.pathname')),// Ensure uniqueness and length less than 50
    distractionFreeMode: false, // Facebook-like distraction free mode
    language:'zh-CN',
    perPage:10,//每次加载的数据大小，最多 100
    distractionFreeMode:false,//类似Facebook评论框的全屏遮罩效果.
    createIssueManually:false,
  });
  (function() {
    if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
      document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.Gitalk 评论系统不能在本地预览效果！';
      return;
    }
    gitalk.render('gitalk-container');
  })();
</script>
{{ end }}
